---
// src/components/sections/ImpactCaseStudies.astro
// Redesigned: Concise, Clear & Convincing Impact Metrics
import AnimateOnScroll from '../ui/AnimateOnScroll.astro';

interface Props {
  currentLang: 'id' | 'en';
}

const { currentLang: lang } = Astro.props;

const contactUrl = lang === 'en' ? '/en/contact' : '/kontak';

// Impact-focused case studies data
const caseStudies = [
  {
    brand: "Pertamina",
    logo: "âš¡",
    category: "Energy",
    color: "#3b82f6",
    gradient: "from-blue-500 to-cyan-500",
    target: "Brand Awareness & Issue Management",
    reach: "2M",
    media: "100+",
    kpi: "131%",
    kpiLabel: "KPI Achievement",
    highlights: ["Media Strategy", "Issue Management", "KOL Engagement"]
  },
  {
    brand: "Telkom",
    logo: "ðŸ“¡",
    category: "Telecommunications",
    color: "#06b6d4",
    gradient: "from-cyan-500 to-blue-500",
    target: "Digital Campaign Awareness",
    reach: "1M",
    media: "50+",
    kpi: "85%",
    kpiLabel: "Brand Awareness Lift",
    highlights: ["Media Buying", "Influencer Marketing", "Campaign Optimization"]
  },
  {
    brand: "Fadil Jaidi",
    logo: "ðŸŽ¯",
    category: "Influencer Campaign",
    color: "#8b5cf6",
    gradient: "from-purple-500 to-pink-500",
    target: "Viral Campaign & Engagement",
    reach: "26M",
    media: "26M",
    kpi: "76",
    kpiLabel: "CPV (Cost Per View)",
    highlights: ["KOL Management", "Viral Strategy", "Content Engagement"]
  }
];

// Quick stats for social proof
const quickStats = [
  { value: "50+", label: lang === 'id' ? "Brand Terlayani" : "Brands Served" },
  { value: "500M+", label: lang === 'id' ? "Total Reach" : "Total Reach" },
  { value: "130%", label: lang === 'id' ? "Avg. KPI Achievement" : "Avg. KPI Achievement" },
  { value: "200+", label: lang === 'id' ? "Media & KOL Partners" : "Media & KOL Partners" }
];

const t = {
  id: {
    title: "Impact Nyata",
    subtitle: "Hasil Terukur, Bukan Janji",
    description: "Kami telah membantu brand-brand terkemuka mencapai target mereka dengan strategi media yang terukur dan dampak nyata.",
    reach: "Reach",
    mediaPartners: "Media & KOL",
    viewAll: "Lihat Semua Case Study",
    wantResults: "Ingin hasil serupa?",
    getInTouch: "Konsultasi Gratis",
    trustedBy: "Dipercaya oleh"
  },
  en: {
    title: "Real Impact",
    subtitle: "Measured Results, Not Promises",
    description: "We've helped leading brands achieve their targets with measurable media strategies and real impact.",
    reach: "Reach",
    mediaPartners: "Media & KOL",
    viewAll: "View All Case Studies",
    wantResults: "Want similar results?",
    getInTouch: "Free Consultation",
    trustedBy: "Trusted by"
  }
};

const data = t[lang];
---

<section class="relative py-32 bg-gradient-to-br from-white via-gray-50 to-blue-50 overflow-hidden">
  <!-- Animated Background -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <!-- Animated Gradient Orbs -->
    <div class="absolute top-20 right-20 w-[600px] h-[600px] bg-gradient-to-br from-blue-100/40 via-cyan-100/40 to-purple-100/40 rounded-full blur-3xl animate-pulse-slow"></div>
    <div class="absolute bottom-20 left-20 w-[500px] h-[500px] bg-gradient-to-tr from-cyan-100/40 via-blue-100/40 to-purple-100/40 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: -2s"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-br from-purple-100/30 to-blue-100/30 rounded-full blur-3xl animate-float"></div>

    <!-- Grid Pattern -->
    <div class="absolute inset-0 opacity-[0.03] dark:opacity-[0.05]">
      <div class="absolute inset-0 bg-[linear-gradient(to_right,#0891b2_1px,transparent_1px),linear-gradient(to_bottom,#0891b2_1px,transparent_1px)] bg-[size:50px_50px]"></div>
    </div>

    <!-- Floating Particles -->
    <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-blue-500 rounded-full animate-float-particle opacity-20"></div>
    <div class="absolute top-1/3 right-1/3 w-3 h-3 bg-cyan-500 rounded-full animate-float-particle opacity-15" style="animation-delay: -1s"></div>
    <div class="absolute bottom-1/4 left-1/3 w-2 h-2 bg-purple-500 rounded-full animate-float-particle opacity-20" style="animation-delay: -2s"></div>
    <div class="absolute top-2/3 right-1/4 w-2 h-2 bg-pink-500 rounded-full animate-float-particle opacity-25" style="animation-delay: -3s"></div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto px-6 lg:px-8">
    <!-- Section Header -->
    <AnimateOnScroll animation="fade-up" delay={0} duration={700}>
      <div class="text-center mb-20">
      <div class="inline-flex items-center gap-2 px-5 py-2.5 rounded-full bg-white shadow-2xl border border-gray-200/50 backdrop-blur-sm mb-8">
        <span class="w-2.5 h-2.5 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 animate-pulse"></span>
        <span class="text-sm font-bold text-gray-900 uppercase tracking-wider">Case Studies</span>
      </div>

      <h2 class="text-5xl md:text-6xl lg:text-7xl font-black text-gray-900 mb-6 leading-tight">
        {data.title}
      </h2>

      <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed mb-8">
        {data.description}
      </p>

      <!-- Quick Stats -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mt-16">
        {quickStats.map((stat, index) => (
          <div class="group p-6 rounded-2xl bg-white border border-gray-200 shadow-lg hover:shadow-2xl hover:border-blue-300 transition-all duration-300 hover:transform hover:scale-105">
            <div class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-cyan-500 to-purple-600 mb-2 animate-counter" data-target={stat.value}>
              <span class="counter-value">0</span>
            </div>
            <div class="text-sm font-semibold text-gray-600 uppercase tracking-wider group-hover:text-gray-900 transition-colors">
              {stat.label}
            </div>
          </div>
        ))}
      </div>
    </div>
    </AnimateOnScroll>

    <!-- Case Studies Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
      {caseStudies.map((study, index) => (
        <AnimateOnScroll
          key={study.brand}
          animation="fade-up"
          delay={index * 150}
          duration={700}
          class="group relative bg-white rounded-3xl p-8 shadow-xl border border-gray-100 hover:shadow-2xl hover:border-gray-200 transition-all duration-500 hover:transform hover:scale-[1.02]"
        >
          <!-- Hover Glow -->
          <div class="absolute inset-0 bg-gradient-to-br from-gray-50 to-transparent rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

          <div class="relative z-10">
            <!-- Brand Header -->
            <div class="flex items-center gap-4 mb-6">
              <div class={`w-16 h-16 rounded-2xl bg-gradient-to-br ${study.gradient} flex items-center justify-center text-3xl shadow-lg transform group-hover:scale-110 transition-transform duration-300`}>
                {study.logo}
              </div>
              <div>
                <h3 class="text-xl font-black text-gray-900">{study.brand}</h3>
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">{study.category}</p>
              </div>
            </div>

            <!-- Campaign Goal -->
            <div class="mb-6">
              <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">{lang === 'id' ? 'Target' : 'Objective'}</p>
              <p class="text-base text-gray-700 font-medium leading-snug">{study.target}</p>
            </div>

            <!-- Key Metrics -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="p-4 rounded-xl bg-gray-50 border border-gray-200">
                <div class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 animate-counter" data-target={study.reach}>
                  <span class="counter-value">0</span>
                </div>
                <div class="text-xs font-semibold text-gray-500 mt-1">{data.reach}</div>
              </div>
              <div class="p-4 rounded-xl bg-gray-50 border border-gray-200">
                <div class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-500">{study.media}</div>
                <div class="text-xs font-semibold text-gray-500 mt-1">{data.mediaPartners}</div>
              </div>
            </div>

            <!-- KPI Achievement -->
            <div class="p-4 rounded-xl bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 mb-6">
              <div class="flex items-center justify-between">
                <span class="text-xs font-semibold text-gray-600">{study.kpiLabel}</span>
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-xl font-black text-green-600">{study.kpi}</span>
                </div>
              </div>
            </div>

            <!-- Highlights -->
            <div class="space-y-2">
              {study.highlights.slice(0, 3).map((highlight, i) => (
                <div class="flex items-center gap-2 text-sm text-gray-600">
                  <div class="w-1.5 h-1.5 rounded-full" style={`background-color: ${study.color}`}></div>
                  <span>{highlight}</span>
                </div>
              ))}
            </div>
          </div>

          <!-- Card Shine Effect -->
          <div class="absolute inset-0 rounded-3xl overflow-hidden opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none">
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent transform -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
          </div>
        </div>
      </AnimateOnScroll>
      ))}
    </div>

    <!-- CTA Section -->
    <AnimateOnScroll animation="fade-up" delay={500} duration={700}>
      <div class="text-center">
      <p class="text-xl text-gray-600 mb-8">{data.wantResults}</p>

      <a href={contactUrl} class="group inline-flex items-center gap-4 px-10 py-5 bg-gradient-to-r from-blue-600 via-cyan-500 to-purple-600 text-white font-bold text-lg rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 relative overflow-hidden">
        <!-- Background Animation -->
        <div class="absolute inset-0 bg-gradient-to-r from-blue-700 via-cyan-600 to-purple-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

        <span class="relative z-10">{data.getInTouch}</span>
        <svg class="w-5 h-5 relative z-10 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </AnimateOnScroll>
  </div>
</section>

<style>

  @keyframes float {
    0%, 100% {
      transform: translateY(0px) scale(1);
    }
    50% {
      transform: translateY(-30px) scale(1.1);
    }
  }

  .animate-float {
    animation: float 8s ease-in-out infinite;
  }

  @keyframes pulse-slow {
    0%, 100% {
      opacity: 0.3;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.05);
    }
  }

  .animate-pulse-slow {
    animation: pulse-slow 4s ease-in-out infinite;
  }

  @keyframes float-particle {
    0%, 100% {
      transform: translate(0, 0) scale(1);
      opacity: 0.6;
    }
    25% {
      transform: translate(20px, -30px) scale(1.1);
      opacity: 0.8;
    }
    50% {
      transform: translate(-10px, -50px) scale(0.9);
      opacity: 0.5;
    }
    75% {
      transform: translate(30px, -20px) scale(1.05);
      opacity: 0.7;
    }
  }

  .animate-float-particle {
    animation: float-particle 10s ease-in-out infinite;
  }

  /* Counter Animation */
  .animate-counter .counter-value {
    display: inline-block;
  }

  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>

<script>
  // Counter Animation with alphanumeric support
  const counters = document.querySelectorAll('.animate-counter');
  const speed = 200;

  const animateCounters = () => {
    counters.forEach(counter => {
      const target = counter.getAttribute('data-target');
      const valueEl = counter.querySelector('.counter-value');
      if (!valueEl || !target) return;

      // Check if target is numeric (with optional + or M suffix)
      const numericMatch = target.match(/^([\d.]+)([+M])?$/);

      if (numericMatch) {
        const numValue = parseFloat(numericMatch[1]);
        const suffix = numericMatch[2] || '';
        const count = parseFloat(valueEl.innerText) || 0;
        const inc = numValue / speed * 10;

        if (count < numValue) {
          const newVal = Math.ceil(count + inc);
          valueEl.innerText = newVal + suffix;
          setTimeout(() => requestAnimationFrame(() => {
            const current = parseFloat(valueEl.innerText) || 0;
            if (current < numValue) {
              animateCounters();
            } else {
              valueEl.innerText = numValue + suffix;
            }
          }), 20);
        } else {
          valueEl.innerText = numValue + suffix;
        }
      } else {
        // For non-numeric values, just display them
        valueEl.innerText = target;
      }
    });
  };

  // Initialize animations when in view
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        animateCounters();
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });

  const section = document.currentScript?.closest('section');
  if (section) {
    observer.observe(section);
  }
</script>
