---
// src/components/sections/CommunityDemographics.astro
// Data dari PDF Posthinks Page 6 - Our Community, KOL & Clipper
// Modern Animated Charts Version
import AnimateOnScroll from '@/components/ui/AnimateOnScroll.astro';

interface Props {
  currentLang: 'id' | 'en';
}

const { currentLang: lang } = Astro.props;

const demographics = {
  gender: [
    { label: 'Female', value: 59, color: '#ec4899' },
    { label: 'Male', value: 41, color: '#3b82f6' }
  ],
  interests: [
    { label: 'Lifestyle', value: 27, color: '#8b5cf6' },
    { label: 'Food', value: 24, color: '#f97316' },
    { label: 'Music', value: 10, color: '#ec4899' },
    { label: 'Beauty', value: 10, color: '#d946ef' },
    { label: 'Fashion', value: 8, color: '#8b5cf6' },
    { label: 'Games', value: 7, color: '#6366f1' },
    { label: 'Technology', value: 4, color: '#06b6d4' },
    { label: 'Travel', value: 4, color: '#10b981' },
    { label: 'Otomotif', value: 6, color: '#ef4444' }
  ],
  region: [
    { label: 'Jabodetabek', value: 47, color: '#2563eb' },
    { label: 'Java (luar Jabodetabek)', value: 28, color: '#7c3aed' },
    { label: 'Sumatera', value: 9, color: '#ec4899' },
    { label: 'Kalimantan', value: 6, color: '#f59e0b' },
    { label: 'Sulawesi', value: 5, color: '#10b981' },
    { label: 'Others', value: 5, color: '#6b7280' }
  ],
  age: [
    { label: '17-22', value: 41, color: '#10b981' },
    { label: '22-26', value: 52, color: '#3b82f6' },
    { label: '>26', value: 7, color: '#8b5cf6' }
  ],
  follower: [
    { label: '>1000', value: 25, color: '#14b8a6' },
    { label: '5K - 10K', value: 35, color: '#3b82f6' },
    { label: '>10K+', value: 40, color: '#8b5cf6' }
  ]
};

const t = {
  id: {
    title: 'Demografi Community',
    subtitle: '500+ aktif komunitas, 500 content clippers, dan jaringan 100.000+ talented members',
    totalMembers: 'Total Members',
    activeCommunities: 'Active Communities',
    contentClippers: 'Content Clippers',
    gender: 'Gender',
    interests: 'Minat',
    region: 'Region',
    age: 'Usia',
    follower: 'Follower Count',
    poweredBy: 'Powered by Big Data & AI Analytics'
  },
  en: {
    title: 'Community Demographics',
    subtitle: '500+ active communities, 500 content clippers, and a network of 100,000+ talented members',
    totalMembers: 'Total Members',
    activeCommunities: 'Active Communities',
    contentClippers: 'Content Clippers',
    gender: 'Gender',
    interests: 'Interests',
    region: 'Region',
    age: 'Age',
    follower: 'Follower Count',
    poweredBy: 'Powered by Big Data & AI Analytics'
  }
};

const data = t[lang];
---

<section class="relative py-32 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 overflow-hidden">
  <!-- Animated Background -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <!-- Animated Gradient Orbs -->
    <div class="absolute top-20 right-20 w-[600px] h-[600px] bg-gradient-to-br from-pink-500/20 via-purple-500/20 to-cyan-500/20 rounded-full blur-3xl animate-pulse-slow"></div>
    <div class="absolute bottom-20 left-20 w-[500px] h-[500px] bg-gradient-to-tr from-cyan-500/20 via-blue-500/20 to-purple-500/20 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: -2s"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-br from-purple-600/10 to-pink-600/10 rounded-full blur-3xl animate-float"></div>

    <!-- Grid Pattern -->
    <div class="absolute inset-0 opacity-[0.08]">
      <div class="absolute inset-0 bg-[linear-gradient(to_right,#0891b2_1px,transparent_1px),linear-gradient(to_bottom,#0891b2_1px,transparent_1px)] bg-[size:60px_60px]"></div>
    </div>

    <!-- Floating Particles -->
    <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-pink-500 rounded-full animate-float-particle opacity-60"></div>
    <div class="absolute top-1/3 right-1/3 w-3 h-3 bg-cyan-500 rounded-full animate-float-particle opacity-40" style="animation-delay: -1s"></div>
    <div class="absolute bottom-1/4 left-1/3 w-2 h-2 bg-purple-500 rounded-full animate-float-particle opacity-50" style="animation-delay: -2s"></div>
    <div class="absolute top-2/3 right-1/4 w-2 h-2 bg-blue-500 rounded-full animate-float-particle opacity-60" style="animation-delay: -3s"></div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-20 animate-fade-up">
      <div class="inline-flex items-center gap-2 px-5 py-2.5 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 shadow-2xl mb-8">
        <span class="w-2.5 h-2.5 rounded-full bg-gradient-to-r from-pink-500 to-cyan-500 animate-pulse"></span>
        <span class="text-sm font-bold text-white uppercase tracking-wider">Demographics</span>
      </div>

      <h2 class="text-5xl md:text-6xl lg:text-7xl font-black text-white mb-6 leading-tight">
        {data.title}
      </h2>

      <p class="text-xl text-white/70 max-w-3xl mx-auto leading-relaxed mb-12">
        {data.subtitle}
      </p>

      <!-- Animated Stats Row -->
      <div class="flex flex-wrap justify-center gap-8 md:gap-16">
        <div class="group text-center">
          <div class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 mb-2 animate-counter" data-target="500">
            <span class="counter-value">0</span>+
          </div>
          <div class="text-sm font-semibold text-white/60 uppercase tracking-wider group-hover:text-white/80 transition-colors">
            {data.activeCommunities}
          </div>
        </div>
        <div class="group text-center">
          <div class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 mb-2 animate-counter" data-target="500">
            <span class="counter-value">0</span>+
          </div>
          <div class="text-sm font-semibold text-white/60 uppercase tracking-wider group-hover:text-white/80 transition-colors">
            {data.contentClippers}
          </div>
        </div>
        <div class="group text-center">
          <div class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 mb-2 animate-counter" data-target="100">
            <span class="counter-value">0</span>K+
          </div>
          <div class="text-sm font-semibold text-white/60 uppercase tracking-wider group-hover:text-white/80 transition-colors">
            {data.totalMembers}
          </div>
        </div>
      </div>
    </div>

    <!-- Demographics Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Gender Donut Chart -->
      <AnimateOnScroll animation="fade-up" delay={0} duration={700} class="group relative bg-white/5 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/10 hover:border-pink-500/30 transition-all duration-500 hover:transform hover:scale-[1.02]">
        <div class="absolute inset-0 bg-gradient-to-br from-pink-500/5 to-purple-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <div class="relative z-10">
          <h3 class="text-2xl font-black text-white mb-8 flex items-center gap-3">
            <span class="w-10 h-10 bg-gradient-to-br from-pink-500 to-rose-500 rounded-xl flex items-center justify-center text-lg shadow-lg">
              üë•
            </span>
            {data.gender}
          </h3>

          <!-- Donut Chart -->
          <div class="relative w-48 h-48 mx-auto mb-6">
            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
              <!-- Background Circle -->
              <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12"/>

              <!-- Female Segment (59%) -->
              <circle
                cx="50" cy="50" r="40"
                fill="none"
                stroke="#ec4899"
                stroke-width="12"
                stroke-dasharray={`${59 * 2.51} 251`}
                stroke-linecap="round"
                class="animate-dash"
                style="animation-delay: 0.2s"
              />

              <!-- Male Segment (41%) -->
              <circle
                cx="50" cy="50" r="40"
                fill="none"
                stroke="#3b82f6"
                stroke-width="12"
                stroke-dasharray={`${41 * 2.51} 251`}
                stroke-dashoffset={`-${59 * 2.51}`}
                stroke-linecap="round"
                class="animate-dash"
                style="animation-delay: 0.4s"
              />
            </svg>

            <!-- Center Text -->
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <div class="text-3xl font-black text-white">100%</div>
                <div class="text-xs text-white/60 uppercase tracking-wide">Total</div>
              </div>
            </div>
          </div>

          <!-- Legend -->
          <div class="space-y-3">
            {demographics.gender.map((item) => (
              <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="w-3 h-3 rounded-full shadow-lg" style={`background-color: ${item.color}`}></div>
                  <span class="text-sm font-semibold text-white">{item.label}</span>
                </div>
                <span class="text-xl font-black text-white">{item.value}%</span>
              </div>
            ))}
          </div>
        </div>
      </div>
      </AnimateOnScroll>

      <!-- Age Distribution - Animated Bars -->
      <AnimateOnScroll animation="fade-up" delay={100} duration={700} class="group relative bg-white/5 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/10 hover:border-cyan-500/30 transition-all duration-500 hover:transform hover:scale-[1.02]">
        <div class="absolute inset-0 bg-gradient-to-br from-cyan-500/5 to-blue-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <div class="relative z-10">
          <h3 class="text-2xl font-black text-white mb-8 flex items-center gap-3">
            <span class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center text-lg shadow-lg">
              üéÇ
            </span>
            {data.age}
          </h3>

          <div class="space-y-6">
            {demographics.age.map((item, index) => (
              <div class="group/bar">
                <div class="flex justify-between items-center mb-3">
                  <span class="text-sm font-bold text-white">{item.label}</span>
                  <span class="text-2xl font-black text-white animate-counter" data-target={item.value}>
                    <span class="counter-value">0</span>%
                  </span>
                </div>
                <div class="h-4 bg-white/5 rounded-full overflow-hidden backdrop-blur-sm">
                  <div
                    class="h-full rounded-full transition-all duration-1000 ease-out relative overflow-hidden animate-bar"
                    style={`width: 0%; background: linear-gradient(90deg, ${item.color}, ${item.color}dd)`}
                    data-width={`${item.value}%`}
                  >
                    <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent"></div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
      </AnimateOnScroll>

      <!-- Follower Distribution - Vertical Progress -->
      <AnimateOnScroll animation="fade-up" delay={200} duration={700} class="group relative bg-white/5 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/10 hover:border-purple-500/30 transition-all duration-500 hover:transform hover:scale-[1.02]">
        <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-pink-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <div class="relative z-10">
          <h3 class="text-2xl font-black text-white mb-8 flex items-center gap-3">
            <span class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-lg shadow-lg">
              üë•
            </span>
            {data.follower}
          </h3>

          <div class="space-y-6">
            {demographics.follower.map((item, index) => (
              <div class="flex items-center gap-4">
                <div class="flex-1">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-bold text-white">{item.label}</span>
                    <span class="text-lg font-black text-white">{item.value}%</span>
                  </div>
                  <div class="h-3 bg-white/5 rounded-full overflow-hidden">
                    <div
                      class="h-full rounded-full animate-bar relative overflow-hidden"
                      style={`width: 0%; background: linear-gradient(90deg, ${item.color}, ${item.color}cc)`}
                      data-width={`${item.value}%`}
                    >
                      <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent animate-shimmer"></div>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <!-- Total Badge -->
          <div class="mt-8 pt-6 border-t border-white/10">
            <div class="text-center p-4 rounded-2xl bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20">
              <div class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                100K+
              </div>
              <div class="text-xs text-white/60 uppercase tracking-wide mt-1">
                Active Influencers
              </div>
            </div>
          </div>
        </div>
      </div>
      </AnimateOnScroll>

      <!-- Interest Distribution - Horizontal Bar Chart -->
      <AnimateOnScroll animation="fade-up" delay={300} duration={700} class="group relative bg-white/5 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/10 hover:border-cyan-500/30 transition-all duration-500 hover:transform hover:scale-[1.02] md:col-span-2 lg:col-span-2">
        <div class="absolute inset-0 bg-gradient-to-br from-cyan-500/5 to-blue-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <div class="relative z-10">
          <h3 class="text-2xl font-black text-white mb-8 flex items-center gap-3">
            <span class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center text-lg shadow-lg">
              ‚ù§Ô∏è
            </span>
            {data.interests}
          </h3>

          <!-- Horizontal Bar Chart Container -->
          <div class="relative">
            <!-- Chart Area -->
            <div class="relative h-64 mb-6">
              <!-- Y-Axis Grid Lines -->
              <div class="absolute inset-0 flex flex-col justify-between text-xs text-white/40">
                <div class="border-b border-white/10 pb-1">30%</div>
                <div class="border-b border-white/10 pb-1">20%</div>
                <div class="border-b border-white/10 pb-1">10%</div>
                <div class="border-b border-white/10 pb-1">0%</div>
              </div>

              <!-- Bars Container -->
              <div class="absolute inset-0 flex items-end justify-around px-4 pb-8 gap-2">
                {demographics.interests.map((item, index) => (
                  <div class="flex flex-col items-center gap-2 flex-1 max-w-[80px]">
                    <!-- Bar -->
                    <div class="relative w-full flex items-end justify-center" style="height: 180px;">
                      <!-- Background Track -->
                      <div class="absolute bottom-0 w-full bg-white/5 rounded-t-lg" style="height: 100%;"></div>

                      <!-- Animated Bar -->
                      <div
                        class="relative w-full rounded-t-lg animate-bar-vertical transition-all duration-1000 ease-out hover:brightness-110 cursor-pointer group/bar"
                        style={`height: 0%; background: linear-gradient(180deg, #00d4ff 0%, #0099cc 100%);`}
                        data-height={`${(item.value / 30) * 100}%`}
                      >
                        <!-- Bar Shine Effect -->
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 via-white/5 to-white/20 rounded-t-lg"></div>

                        <!-- Hover Tooltip -->
                        <div class="absolute -top-12 left-1/2 -translate-x-1/2 opacity-0 group-hover/bar:opacity-100 transition-opacity duration-300 pointer-events-none">
                          <div class="bg-slate-900 text-white text-xs font-bold px-3 py-1.5 rounded-lg shadow-xl whitespace-nowrap border border-cyan-500/30">
                            {item.value}%
                          </div>
                          <!-- Tooltip Arrow -->
                          <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-900 border-r border-b border-cyan-500/30 transform rotate-45"></div>
                        </div>
                      </div>
                    </div>

                    <!-- Label -->
                    <div class="text-center">
                      <div class="text-xs font-bold text-white/70 truncate w-full">{item.label}</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <!-- Legend -->
            <div class="flex flex-wrap justify-center gap-4 mt-6 pt-6 border-t border-white/10">
              {demographics.interests.slice(0, 5).map((item, index) => (
                <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10">
                  <div class="w-3 h-3 rounded-sm" style="background: linear-gradient(180deg, #00d4ff 0%, #0099cc 100%);"></div>
                  <span class="text-xs font-semibold text-white/70">{item.label}</span>
                  <span class="text-xs font-bold text-white">{item.value}%</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
      </AnimateOnScroll>

      <!-- Region Distribution - Pie Chart Style -->
      <AnimateOnScroll animation="fade-up" delay={400} duration={700} class="group relative bg-white/5 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/10 hover:border-emerald-500/30 transition-all duration-500 hover:transform hover:scale-[1.02] md:col-span-2 lg:col-span-1">
        <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-cyan-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <div class="relative z-10">
          <h3 class="text-2xl font-black text-white mb-8 flex items-center gap-3">
            <span class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center text-lg shadow-lg">
              üìç
            </span>
            {data.region}
          </h3>

          <div class="grid grid-cols-2 gap-4">
            {demographics.region.map((item, index) => (
              <div class="group/region p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-all duration-300 border border-white/5 hover:border-white/20">
                <div class="flex items-center justify-between mb-3">
                  <div class="w-8 h-8 rounded-xl flex items-center justify-center text-sm shadow-lg" style={`background-color: ${item.color}20`}>
                    üèôÔ∏è
                  </div>
                  <span class="text-xl font-black text-white">{item.value}%</span>
                </div>
                <div class="text-xs font-bold text-white/80 mb-2">{item.label}</div>
                <div class="h-1.5 bg-white/5 rounded-full overflow-hidden">
                  <div
                    class="h-full rounded-full animate-bar"
                    style={`width: 0%; background-color: ${item.color}`}
                    data-width={`${item.value}%`}
                  ></div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
      </AnimateOnScroll>
    </div>

    <!-- Bottom Note -->
    <AnimateOnScroll animation="fade-up" delay={500} duration={700}>
      <div class="mt-20 text-center">
      <div class="inline-flex items-center gap-3 px-8 py-4 bg-white/5 backdrop-blur-sm rounded-full border border-white/10 hover:border-white/20 transition-all duration-300 group">
        <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <span class="text-sm font-bold text-white">{data.poweredBy}</span>
      </div>
    </div>
  </AnimateOnScroll>
  </div>
</section>

<style>

  @keyframes float {
    0%, 100% {
      transform: translateY(0px) scale(1);
    }
    50% {
      transform: translateY(-30px) scale(1.1);
    }
  }

  .animate-float {
    animation: float 8s ease-in-out infinite;
  }

  @keyframes pulse-slow {
    0%, 100% {
      opacity: 0.3;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.05);
    }
  }

  .animate-pulse-slow {
    animation: pulse-slow 4s ease-in-out infinite;
  }

  @keyframes float-particle {
    0%, 100% {
      transform: translate(0, 0) scale(1);
      opacity: 0.6;
    }
    25% {
      transform: translate(20px, -30px) scale(1.1);
      opacity: 0.8;
    }
    50% {
      transform: translate(-10px, -50px) scale(0.9);
      opacity: 0.5;
    }
    75% {
      transform: translate(30px, -20px) scale(1.05);
      opacity: 0.7;
    }
  }

  .animate-float-particle {
    animation: float-particle 10s ease-in-out infinite;
  }

  @keyframes dash {
    from {
      stroke-dashoffset: 251;
    }
  }

  .animate-dash {
    animation: dash 2s ease-out forwards;
  }

  @keyframes bar {
    from {
      width: 0%;
    }
  }

  .animate-bar {
    animation: bar 1.5s ease-out forwards;
  }

  @keyframes bar-vertical {
    from {
      height: 0%;
    }
  }

  .animate-bar-vertical {
    animation: bar-vertical 1.5s ease-out forwards;
  }

  @keyframes shimmer {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  .animate-shimmer {
    animation: shimmer 2s infinite;
  }

  /* Counter Animation */
  .animate-counter .counter-value {
    display: inline-block;
    animation: count-up 2s ease-out forwards;
  }

  @keyframes count-up {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Interactive hover effects */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>

<script>
  // Counter Animation
  const counters = document.querySelectorAll('.animate-counter');
  const speed = 200;

  const animateCounters = () => {
    counters.forEach(counter => {
      const target = +counter.getAttribute('data-target');
      const valueEl = counter.querySelector('.counter-value');
      if (!valueEl) return;

      const count = +valueEl.innerText.replace(/[^0-9]/g, '');
      const inc = target / speed * 10;

      if (count < target) {
        const newVal = Math.ceil(count + inc);
        valueEl.innerText = newVal;
        setTimeout(() => requestAnimationFrame(() => {
          const current = +valueEl.innerText.replace(/[^0-9]/g, '');
          if (current < target) {
            animateCounters();
          } else {
            valueEl.innerText = target;
          }
        }), 20);
      } else {
        valueEl.innerText = target;
      }
    });
  };

  // Bar Animation - Set width from data attribute
  const bars = document.querySelectorAll('.animate-bar');
  bars.forEach((bar, index) => {
    setTimeout(() => {
      const width = bar.getAttribute('data-width');
      if (width) {
        bar.style.width = width;
      }
    }, index * 100);
  });

  // Vertical Bar Animation - Set height from data attribute
  const verticalBars = document.querySelectorAll('.animate-bar-vertical');
  verticalBars.forEach((bar, index) => {
    setTimeout(() => {
      const height = bar.getAttribute('data-height');
      if (height) {
        bar.style.height = height;
      }
    }, index * 100);
  });

  // Initialize animations when in view
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        animateCounters();
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });

  const section = document.currentScript?.closest('section');
  if (section) {
    observer.observe(section);
  }
</script>
