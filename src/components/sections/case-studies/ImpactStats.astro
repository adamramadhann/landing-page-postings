---
// src/components/sections/ImpactStats.astro
// Impact Stats Section - Horizontal Scroll
import AnimateOnScroll from '@/components/ui/AnimateOnScroll.astro';

interface Props {
  locale: 'id' | 'en';
  title: string;
  stats: Array<{
    metric: string;
    label: { id: string; en: string };
    description: { id: string; en: string };
  }>;
}

const { locale, title, stats } = Astro.props;
---

<section class="relative py-32 bg-white overflow-hidden" id="impact-stats">
  <!-- Animated Background -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <!-- Grid Pattern -->
    <div class="absolute inset-0 opacity-[0.03]">
      <div class="absolute inset-0 bg-[linear-gradient(to_right,#0891b2_1px,transparent_1px),linear-gradient(to_bottom,#0891b2_1px,transparent_1px)] bg-[size:60px_60px] animate-grid-pan"></div>
    </div>

    <!-- Floating Gradient Orbs -->
    <div class="absolute top-40 left-20 w-[400px] h-[400px] bg-gradient-to-br from-cyan-200/30 to-teal-200/30 rounded-full blur-3xl animate-float"></div>
    <div class="absolute bottom-40 right-20 w-[500px] h-[500px] bg-gradient-to-tr from-blue-200/30 to-cyan-200/30 rounded-full blur-3xl animate-float" style="animation-delay: -4s"></div>

    <!-- Floating Particles -->
    <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-cyan-500 rounded-full animate-float-particle opacity-30"></div>
    <div class="absolute top-1/3 right-1/3 w-3 h-3 bg-teal-500 rounded-full animate-float-particle opacity-20" style="animation-delay: -1s"></div>
    <div class="absolute bottom-1/4 left-1/3 w-2 h-2 bg-blue-500 rounded-full animate-float-particle opacity-25" style="animation-delay: -2s"></div>
  </div>

  <div class="relative z-10">
    <!-- Section Title -->
    <div class="max-w-7xl mx-auto px-6 lg:px-8 mb-12">
      <AnimateOnScroll animation="fade-up" delay={0} duration={700}>
        <h2 class="text-4xl lg:text-5xl font-black text-gray-900 text-center">
          {title}
        </h2>
      </AnimateOnScroll>
    </div>

    <!-- Horizontal Scroll Cards -->
    <div class="flex gap-8 overflow-x-auto pb-8 scrollbar-hide snap-x snap-mandatory px-6 lg:px-8">
      {stats.map((stat, index) => (
        <AnimateOnScroll
          key={index}
          animation="fade-up"
          delay={index * 100}
          duration={700}
          class="flex-shrink-0 w-80 bg-gradient-to-br from-gray-50 to-white rounded-3xl p-8 shadow-xl hover:shadow-2xl hover:border-cyan-200 border-2 border-transparent transition-all duration-300 snap-center"
        >
          <div class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-teal-600 mb-4 animate-counter" data-target={stat.metric}>
            <span class="counter-value">0</span>
          </div>
          <div class="text-xl font-bold text-gray-900 mb-2">{stat.label[locale]}</div>
          <div class="text-sm text-gray-600">{stat.description[locale]}</div>
        </AnimateOnScroll>
      ))}
    </div>
  </div>
</section>

<style>
  @keyframes float {
    0%, 100% {
      transform: translateY(0px) scale(1);
    }
    50% {
      transform: translateY(-30px) scale(1.1);
    }
  }

  @keyframes float-particle {
    0%, 100% {
      transform: translate(0, 0) scale(1);
      opacity: 0.6;
    }
    25% {
      transform: translate(20px, -30px) scale(1.1);
      opacity: 0.8;
    }
    50% {
      transform: translate(-10px, -50px) scale(0.9);
      opacity: 0.5;
    }
    75% {
      transform: translate(30px, -20px) scale(1.05);
      opacity: 0.7;
    }
  }

  @keyframes grid-pan {
    0% {
      transform: translateX(0) translateY(0);
    }
    100% {
      transform: translateX(-30px) translateY(-30px);
    }
  }

  .animate-float {
    animation: float 8s ease-in-out infinite;
  }

  .animate-float-particle {
    animation: float-particle 10s ease-in-out infinite;
  }

  .animate-grid-pan {
    animation: grid-pan 15s ease-in-out infinite alternate;
  }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Reduced Motion Support */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>

<script>
  // Counter Animation
  const counters = document.querySelectorAll('.animate-counter');
  const speed = 200;

  const animateCounters = () => {
    counters.forEach(counter => {
      const target = counter.getAttribute('data-target');
      const valueEl = counter.querySelector('.counter-value');
      if (!valueEl || !target) return;

      const numericMatch = target.match(/^([\d.]+)([+M%K]?)([^0-9]*)$/);

      if (numericMatch) {
        const numValue = parseFloat(numericMatch[1]);
        const suffix = numericMatch[2] || '';
        const extra = numericMatch[3] || '';
        const count = parseFloat(valueEl.innerText) || 0;
        const inc = numValue / speed * 10;

        if (count < numValue) {
          const newVal = Math.ceil(count + inc);
          valueEl.innerText = newVal + suffix + extra;
          setTimeout(() => requestAnimationFrame(() => {
            const current = parseFloat(valueEl.innerText) || 0;
            if (current < numValue) {
              animateCounters();
            } else {
              valueEl.innerText = numValue + suffix + extra;
            }
          }), 20);
        } else {
          valueEl.innerText = numValue + suffix + extra;
        }
      } else {
        valueEl.innerText = target;
      }
    });
  };

  // Initialize when in view
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        animateCounters();
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });

  const section = document.currentScript?.closest('section');
  if (section) {
    observer.observe(section);
  }
</script>
